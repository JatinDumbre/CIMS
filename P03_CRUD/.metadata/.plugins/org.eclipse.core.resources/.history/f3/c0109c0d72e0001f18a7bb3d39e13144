package com.cims.crud.services;


import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.cims.crud.entities.User;
import com.cims.crud.entities.User_archive;
import com.cims.crud.repositories.AdminRepository;
import com.cims.crud.repositories.UserArchiveRepository;
import com.cims.crud.repositories.UserRepository;

import jakarta.transaction.Transactional;

@Service
public class AdminService {
	@Autowired
	AdminRepository arepo;
	
	@Autowired
	UserArchiveRepository uarepo;
	
	@Autowired
	UserRepository urepo;
	public Optional<Object[]> getAll(){
		return arepo.findAllEmployees();
	}
	public void deleteUser(int uid) {
		arepo.deleteById(uid);
	}
	 @Transactional
	    public void archiveAndDeleteUser(int userId) {
	        User user = urepo.findById(userId)
	                .orElseThrow(() -> new RuntimeException("User not found"));

	        // Move user data to archive table
	        User_archive userArchive = new User_archive(user);
	        uarepo.save(userArchive);

	        // Delete user from main table
	        arepo.delete(user);
}
}
